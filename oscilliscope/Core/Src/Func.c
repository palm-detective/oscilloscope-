/*
 * Func.c
 *
 *  Created on: Jun 4, 2021
 *      Author: paul_
 */

#include "Func.h"

/*******************************************************************************
 u8ToDec3: Change Byte to 3 decimal number string
*******************************************************************************/
void u8ToDec3(char *p, char n)
{
    *p++ = '0'+n/100;
    n %= 100;
    *p++ = '0'+n/10;
    n %= 10;
    *p++ = '0'+n;
    *p = 0;
}

// 16 bit memset

void memset16(unsigned short* ptr, unsigned short value, short len)
{
	while(len!=0)
	{
		*ptr++ = value;
		len--;
	}
}

/*******************************************************************************
 Value2Str: 32λ��תeλ��Ч���ַ��� + �����ַ������ṹΪUnit[][6]��+  ģʽ
*******************************************************************************/
void Value2Str(char *p, long n, const char *pUnit, char e, char Mode)
{
  short i = 0;
  long m = n, c = 5;

  if(Mode == SIGN)
  {
    if(n == 0) *p++ = ' ';
    if(n >  0) *p++ = '+';
    if(n <  0){*p++ = '-'; n = -n;}
  }
  while(m >= 10){m /= 10; i++;} // ���� n ����Чλ�� i
  if((i%3 == 2)&&(e == 2)) e++;
  m = n; i = 0;
  while(m >= 10)
  {
    m /= 10;
    if(++i > e) c *= 10;        // n ����Чλ�� i ����e�������������ֵ
  }
  if(i >= e) n += c;            // n ������������ֵ
  m = n; i = 0;
  while(m >= 10){m /= 10; i++;} // ���¼��� n ����Чλ�� i

  m = i/3;                      // �������ٵ�λȡֵƫ����
  while(e--)
  {
    *p++ = '0'+ n/Exp(i);
    if(e &&(i%3 == 0)) *p++ = '.';
    n = (i < 0)? 0 : n%Exp(i);
    i--;
  }
  pUnit += 6*m;                 //
  do {*p++ = *pUnit;}
  while(*pUnit++);              // ���������ַ��ַ���
}

/*******************************************************************************
  ���� 10 �� x �η�
*******************************************************************************/
long Exp(char x)
{
  long m = 1;

  while(x--)
	  m *= 10;
  return m;
}

/*******************************************************************************
 Int_sqrt: unsigned int square root
*******************************************************************************/
short Sqrt32(int n)
{
	int k;
  if ( n == 0 ) return 0;
  k = 2*Sqrt32(n/4)+1;
  if ( k*k > n ) return k-1;
  else return k;
}

/*******************************************************************************
 u16ToDec4Str: �޷���16λ��������ת4λʮ�����ַ�������Ч����ǰ��ո�
*******************************************************************************/
void u16ToDec4Str(char *p, short n)
{
  if(n/10000){
    *p++ = 'O';
    *p++ = 'v';
    *p++ = 'e';
    *p++ = 'r';
    *p   = 0;
    return;
  }
  *p++ = '0'+n/1000;
  n %= 1000;
  *p++ = '0'+n/100;
  n %= 100;
  *p++ = '0'+n/10;
  n %= 10;
  *p++ = '0'+n;
  *p = 0;
  if(p[-4] == '0'){
    p[-4] = ' ';
    if(p[-3] == '0'){
      p[-3] = ' ';
      if(p[-2] == '0') p[-2] = ' ';
    }
  }
}
